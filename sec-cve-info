#!/bin/bash -eu

function usage()
{
	cat <<EOF
Usage: sec-cve-info [CVE]

Show information about the provided CVE. If CVE is not provided, determine the
CVE number from the current branch name.

Optional arguments:
  -h, --help  Show this help text and exit.
  -w, --www   Open the Ubuntu security page.
EOF
}

www=0
cve=

while [ ${#} -gt 0 ] ; do
	case "${1}" in
		-h|--help)
			usage
			exit
			;;
		-w|--www)
			www=1
			;;
		*)
			if [ -n "${cve}" ] ; then
				echo "Invalid argument: ${1}" >&2
				exit 2
			fi
			cve=${1}
			;;
	esac
	shift
done

if [ -z "${cve}" ] ; then
	branch=$(git rev-parse --abbrev-ref HEAD)
	cve=${branch%/*}
fi

cve=${cve^^}
cve=CVE-${cve#CVE-}

if [ ${www} -eq 1 ] ; then
	xdg-open https://ubuntu.com/security/"${cve}"
fi

cat ~/git/cron/ubuntu-cve-tracker/active/"${cve}"
